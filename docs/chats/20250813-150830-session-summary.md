# Chat Summary: 2025-08-13 - Task/Time/BugWarrior Setup & `cocli` CRM Development

This document provides a verbose summary of the collaborative development session, detailing the setup, debugging, and creation of a comprehensive CLI-based productivity and CRM system.

---

## Phase 1: Initial Setup & Bugwarrior Configuration

Our initial goal was to configure `bugwarrior` to sync issues from GitHub and Jira into Taskwarrior, using 1Password's `op` CLI for secure secret management.

### Key Challenges & Resolutions:

1.  **Secret Management:**
    *   **Problem:** Storing API tokens directly in `~/.config/bugwarrior/bugwarriorrc` was insecure.
    *   **Solution:** We adopted the `@oracle:eval:` syntax to have `bugwarrior` fetch secrets directly from the 1Password CLI using `op read op://...`. We also corrected the field name from the assumed `token` to the correct `credential`.

2.  **Installation & Versioning:**
    *   **Problem:** The `bugwarrior` command was not found. We discovered it wasn't installed.
    *   **Initial Attempt:** `pip install` failed due to an `externally-managed-environment` error, a safeguard in modern Python distributions.
    *   **Solution:** We used `uv` to install `bugwarrior` into a dedicated virtual environment at `~/.venvs/bugwarrior`.

3.  **Python Compatibility Bugs:**
    *   **Problem 1:** The installed version of `bugwarrior` (1.8.0) was incompatible with Python 3.12, causing an `AttributeError: 'BugwarriorConfigParser' object has no attribute 'readfp'`.
    *   **Problem 2:** The `develop` branch from GitHub had a `ModuleNotFoundError` due to an incomplete refactoring.
    *   **Solution:** We settled on the `master` branch version and manually patched the code in the virtual environment, changing the deprecated `readfp` method to the modern `read_file`.

4.  **API & Configuration Errors:**
    *   **Problem:** We encountered a series of configuration errors and an API bug.
    *   **Solutions:**
        *   Corrected the `targets` list in `bugwarriorrc` to be comma-separated instead of space-separated.
        *   Added the required `github.username` and `jira.username` fields.
        *   Corrected the Jira configuration to use `jira.password` for the API token and `jira.base_uri` for the server URL.
        *   Patched the `bugwarrior` source code again to fix a bug where it was sending `maxResults=-1` to the Jira API, which is no longer supported. We changed it to `maxResults=None`.

### Outcome of Phase 1:

We achieved a fully functional, patched `bugwarrior` installation that could successfully sync issues from both GitHub and Jira into Taskwarrior.

---

## Phase 2: System Integration & Workflow Creation

With the core tools working, we moved on to integrating them and building a user-friendly workflow.

1.  **Taskwarrior & TimeWarrior Integration:**
    *   We verified that the `on-modify.timewarrior` hook was correctly installed in `~/.task/hooks/`, enabling automatic time tracking when tasks are started and stopped.

2.  **Custom Cheatsheet:**
    *   To document the new workflow, we created a custom help file at `~/task-workflow-cheatsheet.md` covering the main commands for syncing, managing tasks, using contexts, and tracking time.

3.  **Shell Environment Debugging:**
    *   **Problem 1:** An old, incompatible Taskwarrior hook (`WarnOnTaskCongestion`) was causing errors.
    *   **Solution 1:** We disabled the hook by making it non-executable with `chmod -x`.
    *   **Problem 2:** A Taskwarrior v3 migration warning persisted after the import.
    *   **Solution 2:** We moved the old `.data` files into a `~/task/v2_backup` directory to silence the warning.

---

## Phase 3: Designing and Building the `cocli` CRM Tool

The most substantial part of our session was designing and building a custom, CLI-first CRM tool from scratch.

### Initial Design (Bash Scripts):

*   **Concept:** A lightweight CRM using a directory structure (`~/companies`) and plain text files.
*   **Initial Implementation:** We started with simple Bash scripts (`company-add-meeting`, `company-find`) that used `fzf` for interactive selection.
*   **Refinement:** We evolved this into a single `cocli` dispatcher script with a `lib` directory for subcommands, a `README.md`, and a `HELP.md` file.

### The Tipping Point: Moving from Bash to Python

*   **Problem:** We quickly identified the limitations of Bash for this project:
    1.  Fragile argument parsing (whitespace issues).
    2.  No native data structures or validation.
    3.  Difficulty handling complex file formats like quoted CSVs.
*   **Decision:** We made the strategic decision to refactor `cocli` into a proper Python application to solve these problems systematically.

### Final Architecture (Python):

*   **Project Management:** We set up a `pyproject.toml` file and used `uv` to manage a virtual environment and dependencies.
*   **Core Libraries:**
    *   **Typer:** For a robust and user-friendly command-line interface.
    *   **Pydantic:** To define `Company` and `Person` data models, providing automatic validation and structure.
    *   **PyYAML:** To write structured data to YAML frontmatter in the Markdown files.
*   **Data Model & Structure:**
    *   **XDG Compliance:** We moved the data directory to the standard `~/.local/share/cocli/` to avoid cluttering the home directory.
    *   **Unified Data:** We created a single data directory containing `companies/` and `people/` subdirectories.
    *   **Relationships via Symlinks:** We adopted a powerful model where a person has a single source file in `~/people`, and their association with a company is represented by a symbolic link in that company's `contacts` directory.
*   **Extensible Importer:** We designed a modular importer system (`cocli import <format> <filepath>`) that calls named scripts in a `lib/importers/` directory, allowing for future expansion.

### Final Debugging & Polish:

*   **Python Packaging:** We solved a persistent `ModuleNotFoundError` by creating the necessary `__init__.py` file, officially turning the `cocli` source directory into an importable Python package.
*   **Shell Integration:** We created a final, robust wrapper script at `~/.local/bin/cocli` that uses `uv run` to correctly execute the Python application from its virtual environment, solving all path and module issues.
*   **`.bashrc` & Starship Prompt:** We debugged and fixed several critical issues in the user's shell configuration, including a broken `PATH` variable, an incorrect `epoch` script, and incorrect initialization order for Starship, Zoxide, and other prompt-modifying tools. We restored the user's custom two-line Starship prompt.

---

## Final Outcome:

We successfully built a complete, integrated, and professional-grade CLI workflow. This includes a fully configured issue tracker sync, a time tracker, and a custom-built, extensible CRM tool with a robust data model and a user-friendly interface. The system is now stable, well-documented, and ready for daily use.
